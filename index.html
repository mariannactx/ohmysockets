<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ohmysockets!</title>
    <link rel="stylesheet" href="css/journal.css"/>
    <link rel="stylesheet" href="css/style.css"/>
    <script src="js/jquery.js"></script>
    <script src="js/util.js"></script>
    <script src="js/collapse.js"></script>
</head>
<body class="row">
    <header class="col-lg-2 bg-info">
        <nav class="navbar navbar-dark navbar-expand-lg">
            <a class="nav-link text-light text-center" href="#o-framework">
                <img id="logo" src="img/omskts.png"/>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menu-toggler">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="menu-toggler">
            <ul class="navbar-nav mr-auto flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="#documentacao">
                        - <br/>Documentação
                    </a>
                    <ul>
                        <li class="nav-item">
                            <a class="nav-link" href="#instalacao">
                                . Requisitos
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#instalacao">
                                . Downloads
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#inicializacao">
                                . Inicialização
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#como-funciona">
                                . O básico
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#exemplos">
                                - <br/>Exemplos</a>
                        </li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#demo">
                        - <br/>Demo
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#creditos">
                        - <br/>Créditos
                    </a>
                </li>
            </ul>
            </div>
        </nav>
    </header>
    <main class="col-lg-10">
        <section id="o-framework">
            <h1 class="display-4">ohmysockets!</h1>
            <small class="text-muted">Abreviação para "oh my god, it's so simple to use websockets!".</small>
            <p class="lead">
                É um micro framework PHP simples e rápido para comunicação dentro de redes locais. Permite criar uma conexão persistente e bidirecional para ser utilizada em sua aplicação web sem complicações.
            </p>
            <hr class="my-4">
            <h3>Web, persistente e bidirecional</h3>
            <p> <i>Websockets</i> é o recurso que tornou possível usar o <i>browser</i> para abrir uma conexão que se mantém <i>sempre aberta e disponível</i> através da qual podemos enviar e receber informações <i>simultaneamente e sem interrupções</i>.</p>
            <h3>Módulos</h3>

            <h5>Servidor</h5>
            <p>Cria e mantém nossa conexão além de gerenciar os usuários que se conectarem ao nosso servidor. Inicializado com um quase nada de comandos no terminal.</p>
            <h5>Cliente</h5>
            <p>Apresenta <b>dois exemplos</b> simples e reutilizáveis para quem quer saber a opinião de sua audiência em tempo real ou competir com os amigos num jogo de plataforma.</p>

        </section>

        <section id="documentacao">
            <h1 class="display-4">Documentação</h1>
            <hr class="my-4">

            <article id="instalacao">
                <div class="card border-light">
                    <h2 class="card-header text-info">Requisitos</h2>
                    <div class="card-body">
                        <ul>
                            <li>Apache e PHP 7 <small>(veja um tutorial sobre <a href="tutorial">como instalar um servidor web</a>)</small></li>

                        </ul>
                    </div>
                </div>
            </article>

            <article id="instalacao">
                <div class="card border-light">
                    <h2 class="card-header text-info">Downloads</h2>
                    <div class="card-body">
                        <a class="btn btn-outline-danger" href="server.zip">
                            Módulo servidor
                        </a>
                        <a class="btn btn-outline-danger" href="ohmysockets.zip">
                            Módulos servidor e cliente
                        </a>
                    </div>
                </div>
            </article>

            <article id="inicializacao">
                <div class="card border-light">
                    <h2 class="card-header text-info">Inicialização</h2>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Via terminal</th>
                                    <th>Via browser</th>
                                </tr>    
                            </thead>
                            <tbody>
                                    
                            </tbody>
                        </table>
                        <p> mac, windows e linux
                            servidor local
                            endereço ip na rede local
                            porta disponível
                            alterar ip e porta no arquivo run.php
                            rodar script no terminal e explicar saídas (websockets rodando, cliente conectado e desconectado)
                            alterar endereço ws:// no common.js
                            Entrar na pasta <kbd>cd pasta</kbd><br/>
                            Inicializar conexão <kbd> php run.php</kbd><br/>
                            <kbd> php server.php</kbd>
                        </p>
                    </div>
                </div>
            </article>

            <article id="como-funciona">
                <div class="card border-light">
                    <h2 class="card-header text-info">O básico</h2>
                    <div class="card-body">
                        <h4>A extensão sockets do PHP</h4>
                        <small><a href="https://secure.php.net/manual/pt_BR/book.sockets.php">manual oficial da extensão</a></small>
                        <p>O construtor da nossa classe abstrata WebsocketServer é o responsável por criar a conexão. Mais especificamente, <i>cria</i>, <i>configura</i>, <i>torna acessível</i> e <i>ouve</i> um <i>resource do tipo socket</i>.</p>

                        <pre>

$this->master = socket_create(...);

socket_set_option($this->master, ...);
socket_bind($this->master, <b>$addr</b>, <b>$port</b>);
socket_listen($this->master, 10);

$this->sockets['m'] = $this->master;
                        </pre>

                        <p>Onde <kbd>$addr</kbd> é o IP da máquina onde o servidor está e <kbd>$port</kbd> é uma porta disponível no nosso servidor - que pode ser aleatória. Essas informações são fornecidas no script run.php que vai ser executado via terminal (ou da maneira que você preferir):
                        </p>

                        <pre>

$server = new Server("192.168.0.0", '11111');
$server->run();
                        </pre>

                        <p>Se aparecer uma mensagem que começa com <b><i>"Server started"</i></b> deu tudo certo! O servidor está ouvindo requisições através da porta que você escolheu.</p>

                        <h4>A API Websockets</h4>
                        <small><a href="https://html.spec.whatwg.org/multipage/web-sockets.html">especificação oficial da API</a></small>
                        <p> Uma vez iniciada a conexão, nossa aplicação poderá enviar e receber dados através dela, utilizando a <i>API Websockets</i> e seus eventos com <i>javascript</i>.</p>
                        <pre>

socket = new WebSocket("ws://192.168.0.0:11111");

socket.onopen    = function(ev) {};
socket.onclose   = function(ev) {};
socket.onmessage = function(ev) {
    msg = JSON.parse(ev.data);
};

socket.send('{"prop":"value"}'); //string em formato JSON
                        </pre>
                        <p>É realmente muito simples: <kbd>onopen</kbd> acontece assim que a conexão é estabelecida, <kbd>onmessage</kbd> é disparada sempre que chegar novos dados e <kbd>onclose</kbd> quando a conexão for fechada pelo cliente ou pelo servidor.
                        </p>
                        <p><span class="badge badge-pill badge-danger">Atenção!</span> O evento <kbd>onmessage</kbd> traz um objeto do tipo MessageEvent, diferente das demais. A propriedade <kbd>data</kbd> contém os dados recebidos em uma string no formato JSON. Como implementação do framework, sempre possui a propriedade <kdb>user</kdb> como identificação do usuário que enviou a mensagem, até mesmo quando é o servidor. É utilizado <i>um número único com a função do PHP <kbd>uniqid()</kbd> </i> para identificar a origem da mensagem. Você pode modificar isso sobrescrevendo o método <kdb>setId()</kdb> da classe <kdb>User</kdb>, para utilizar um número incremental do seu banco de dados, por exemplo.
                        </p>

                        <h4>O protocolo websockets</h4>
                        <p>Perceba que a url utilizada na API não começa com o habitual <kbd>http://</kbd>, mas com <kbd>ws://</kbd></p>.
                        <p> HTTP com upgrade para WS </p>
                        <video width="100%" src="vid/websockets-network-ratchet.mp4" controls></video>
                    </div>
                </div>
            </article>

            <article id="exemplos">
                <div class="card border-light">
                    <h2 class="card-header text-info">Exemplos</h2>
                    <div class="card-body">
                        <h3>Carinhas</h3>
                        <p class="bg-dark card-img">
                            <img src="img/carinhas.png">
                        </p>
                        <p>
                            For example, <code>&lt;section&gt;</code> should be wrapped as inline.
                        </p>

                        <hr class="my-4">
                        <h3>Exemplo: Jogo multiplayer</h3>

                        <p class="bg-dark card-img">
                            <img src="img/jogo.png">
                        </p>
                        <p>
                            For example, <code>&lt;section&gt;</code> should be wrapped as inline.
                            <kbd> php server.php </kbd>
                        </p>
                    </div>
                </div>
            </article>
        </section>

        <section id="demo">
            <h1 class="display-4">Demo</h1>
            <hr class="my-4">
            <video src="index.html"></video>
        </section>

        <section id="creditos">
            <h1 class="display-4">Créditos</h1>
            <p class="lead">This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured content or information.</p>
            <hr class="my-4">

            <h2>O servidor</h2>
            <h2>Carinhas</h2>
            <h2>Jogo multiplayer</h2>
        </section>

        <footer class="bg-info text-white">
            Trabalho desenvolvido como parte do projeto de conclusão de curso 
            em Comunicação em Mídias Digitais na Universidade Federal da Paraíba.
        </footer>
    </main>
</body>
</html>